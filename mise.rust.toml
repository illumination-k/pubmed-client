# Loaded with MISE_ENV=rust
# Rust-specific test tooling and workspace tasks
# Used by: core.yml, integration-tests.yml

[tools]
"cargo:cargo-nextest" = "latest"
"cargo:cargo-llvm-cov" = "latest"

# ── Rust workspace tasks ──────────────────────────────────────────────────────

[tasks.test]
description = "Run tests for entire workspace using nextest"
run = ["cargo nextest run --workspace"]

[tasks.doctest]
description = "Run doc tests for core Rust library"
run = ["cargo test --doc -p pubmed-client"]

[tasks.build]
description = "Build entire workspace"
run = ["cargo build --workspace"]

[tasks.check]
description = "Check entire workspace without building"
run = ["cargo check --workspace"]

[tasks.coverage]
description = "Generate HTML coverage report (llvm-cov)"
run = [
  "cargo llvm-cov nextest -p pubmed-client --all-features --no-report",
  "cargo llvm-cov report --html",
  "cargo llvm-cov report --text",
]

# ── CI-equivalent tasks ───────────────────────────────────────────────────────

[tasks."ci:core"]
description = "Equivalent to core.yml: unit tests + doc tests"
run = ["cargo nextest run --workspace", "cargo test --doc -p pubmed-client"]
