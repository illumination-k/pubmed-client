# Loaded with MISE_ENV=rust
# Rust-specific test tooling and workspace tasks
# Used by: rust.yml, integration-tests.yml

[tools]
"cargo:cargo-nextest" = "latest"
"cargo:cargo-llvm-cov" = "latest"

[tasks."fmt:rs"]
description = "Format Rust code with cargo fmt"
run = ["cargo fmt --all"]

[tasks."lint:rs"]
description = "Lint Rust code with cargo clippy"
run = [
  "cargo fmt --all -- --check",
  "cargo clippy --workspace --all-targets -- -D warnings",
]

[tasks."test:rs"]
description = "Run tests for entire workspace using nextest"
run = ["cargo nextest run --workspace"]

[tasks."doctest:rs"]
description = "Run doc tests for entire workspace"
run = ["cargo test --doc --workspace --exclude pubmed-client-py"]

[tasks."build:rs"]
description = "Build entire workspace"
run = ["cargo build --workspace"]

[tasks."check:rs"]
description = "Check entire workspace without building"
run = ["cargo check --workspace"]

[tasks."coverage:rs"]
description = "Generate HTML coverage report (llvm-cov)"
run = [
  "cargo llvm-cov nextest --workspace --all-features --no-report",
  "cargo llvm-cov report --html",
  "cargo llvm-cov report --text",
]

[tasks."ci:rs"]
description = "Equivalent to rust.yml: unit tests + doc tests"
depends = ["lint:rs", "test:rs", "doctest:rs"]
