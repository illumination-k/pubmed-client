# Loaded with MISE_ENV=python
# Python ecosystem tools, environment, and tasks
# Used by: python.yml, docs.yml (Python docs)

[tools]
uv = "0.8"

[env]
PYO3_PYTHON = "{{config_root}}/pubmed-client-py/.venv/bin/python"
PYO3_USE_ABI3_FORWARD_COMPATIBILITY = "1"

# ── Python tasks ──────────────────────────────────────────────────────────────

[tasks."lint:py"]
description = "Lint Python code with ruff and mypy"
dir = "pubmed-client-py"
run = [
  "uv run --frozen ruff check",
  "uv run --frozen mypy .",
  "uv run --frozen ty check",
]

[tasks."test:py"]
description = "Run Python tests with pytest"
dir = "pubmed-client-py"
run = ["uv run --frozen pytest"]

[tasks."fmt:py"]
description = "Format Python code with ruff"
dir = "pubmed-client-py"
run = ["uv run --frozen ruff format"]

[tasks."coverage:py"]
description = "Generate Python coverage report"
dir = "pubmed-client-py"
run = [
  "uv run --frozen pytest --cov=pubmed_client --cov-report=html --cov-report=term",
]

[tasks."build:py"]
description = "Build Python package with maturin"
dir = "pubmed-client-py"
run = ["uv run maturin build"]

[tasks."clean:py"]
description = "Clean Python build artifacts"
dir = "pubmed-client-py"
run = [
  "rm -rf target/ .pytest_cache/ .mypy_cache/ .ruff_cache/ htmlcov/ .coverage",
]

# ── CI-equivalent tasks ───────────────────────────────────────────────────────

[tasks."ci:py"]
description = "Equivalent to python.yml: lint + test"
depends = ["lint:py", "test:py"]
