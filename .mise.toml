[tools]
pre-commit = "latest"
dprint = "latest"

"cargo:cargo-nextest" = "latest"
"cargo:cargo-llvm-cov" = "latest"

pnpm = "10"
node = "20"

[tasks.fmt]
run = ["dprint fmt", "cargo fmt --all"]

[tasks.lint]
run = [
  "dprint check",
  "cargo fmt --all -- --check",
  "cargo clippy --all-targets -- -D warnings",
  "cargo clippy --all-targets --features integration-tests -- -D warnings",
  "cargo clippy --all-targets --features wasm -- -D warnings",
]

[tasks.test]
run = ["cargo nextest run --all-features"]

[tasks.build]
run = ["cargo build"]

[tasks.check]
run = ["cargo check"]

[tasks.doc]
run = ["cargo doc --open"]

[tasks.coverage]
run = ["cargo llvm-cov nextest --all-features --html"]

[tasks."coverage:lcov"]
run = [
  "cargo llvm-cov nextest --all-features --lcov --output-path coverage.lcov",
]

[tasks."coverage:json"]
run = [
  "cargo llvm-cov nextest --all-features --json --output-path coverage.json",
]

[tasks."coverage:open"]
run = ["cargo llvm-cov nextest --all-features --html --open"]

[tasks."wasm:build"]
run = [
  "wasm-pack build --target web --out-dir pkg --features wasm,tsify",
]

[tasks."wasm:build:node"]
run = [
  "wasm-pack build --target nodejs --out-dir pkg --features wasm,tsify",
]

[tasks."wasm:test"]
run = [
  "mise r wasm:build:node",
  "pnpm run test",
]
